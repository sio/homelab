#
# Protect the system with simple firewall
#
---
- name: enable firewall (ufw)
  service:
    name: ufw
    state: started
    enabled: yes

- name: allow SSH access (rate-limited)
  ufw:
    port: ssh
    rule: limit
    proto: tcp

- name: allow HTTP and HTTPS access
  ufw:
    port: '{{ item }}'
    rule: allow
    proto: tcp
  with_items:
    - http
    - https

- name: block outgoing mail
  ufw:
    port: smtp
    rule: deny
    direction: out

- name: deny all incoming requests by default
  ufw:
    state: enabled  # also reloads firewall
    policy: deny

