#
# Execute these tasks before `hlc.yml` to trigger deployment from
# latest git version
#
# when: deploy|default(False)
---
- name: stop the web server
  service:
    name: '{{ server }}'
    state: stopped

- name: check if virtual environment has been created
  stat:
    path: '{{ path.venv }}/bin'
  register: venv

- name: uninstall HomeLibraryCatalog
  pip:
    name:
      - HomeLibraryCatalog
      - scrapehelper
      # Do not delete toolpot here! It's used by backup script in the next step
    state: absent
    virtualenv: '{{ path.venv }}'
  when: venv.stat.isdir is defined and venv.stat.isdir

- name: back up application data
  command: '{{ path.app|quote }}/backup.py'
