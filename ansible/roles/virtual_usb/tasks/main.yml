---

# Hotplug USB passthrough for Libvirt guests

- name: create required directories
  file:
    state: directory
    path: '{{ item }}'
    mode: '0755'
  loop:
    - '{{ virtual_usb_definition|dirname }}'
    - '{{ virtual_usb_udev_rule|dirname }}'

- name: create libvirt device definition
  template:
    src: templates/device.xml.j2
    dest: '{{ virtual_usb_definition }}'
    backup: yes
    mode: '0600'
  notify: add USB device to virtual machine

- name: create udev rule for the device
  template:
    src: templates/udev.rules.j2
    dest: '{{ virtual_usb_udev_rule }}'
    backup: yes
    mode: '0600'
  notify: reload udev rules

- meta: flush_handlers
