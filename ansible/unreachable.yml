- hosts: all
  name: unreachable
  gather_facts: no
  ignore_unreachable: yes
  tasks:
    - name: detect unreachable hosts
      ping:
      changed_when: no
      register: ping

    - name: add unreachable hosts to inventory group
      add_host:
        hostname: '{{ inventory_hostname }}'
        groupname: '{{ unreachable_hosts_group|default("unreachable") }}'
      when: ping is unreachable
      changed_when: no
