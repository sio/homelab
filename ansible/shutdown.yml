---
# Shutdown Linux machines (you probably want to --limit hosts)

- hosts: '{{ limit_hosts|default("all") }}'
  gather_facts: no
  become: yes
  tasks:
    - name: shutdown linux machines
      shell: /sbin/shutdown -c && /sbin/shutdown -h now
      when: '{{ initial_ping|default({"failed": True}) is failed }}'
      register: shutdown
      changed_when: shutdown is failed  # shell module is expected to fail
      failed_when: no
