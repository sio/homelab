---
- hosts: playground  # TODO: integrate into lab.yml, remove playground.yml
  become: yes
  roles:
    - role: upgrade
    - role: motd
    - role: server
      server_remote_user: user
      server_keys_public:
        - '{{ infra_dir }}/keys/playground.pub'
    - role: interactive
      interactive_user: user
    - role: packages
      packages_install: '{{ playground_packages }}'  # group_vars/all.yml
      packages_recommends: no
  pre_tasks:
    - name: enable backports repo
      apt_repository:
        repo: 'deb http://deb.debian.org/debian {{ ansible_distribution_release }}-backports main'
        state: present
        mode: '0600'
      when: ansible_distribution_release == 'buster'
  tasks:
    - name: modify user permissions
      user:
        name: user
        groups: sudo,kvm,libvirt,libvirt-qemu,docker
        append: yes
    - name: enable passwordless sudo
      lineinfile:
        path: /etc/sudoers
        line: user ALL=(ALL) NOPASSWD:ALL
        state: present
        validate: visudo -cf %s
